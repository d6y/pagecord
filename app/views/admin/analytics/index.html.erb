<div class="space-y-6">
  <!-- Date/View Type Navigation -->
  <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
      <!-- View Type Buttons -->
      <div class="flex space-x-2 justify-center md:justify-start">
        <% 
          context_month = case @view_type
            when "year"
              Date.new(@date.year, Date.current.month, 1)
            else 
              @date
          end
          
          context_year = @date.beginning_of_year
        %>
        <%= link_to admin_analytics_path(view_type: "month", date: context_month.strftime("%Y-%m")), 
            class: "px-4 py-2 text-sm font-medium rounded-lg transition-colors #{@view_type == 'month' ? 'bg-[#4fbd9c] text-white hover:bg-[#4bb193]' : 'bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600'}" do %>
          Month
        <% end %>
        <%= link_to admin_analytics_path(view_type: "year", date: context_year.strftime("%Y")), 
            class: "px-4 py-2 text-sm font-medium rounded-lg transition-colors #{@view_type == 'year' ? 'bg-[#4fbd9c] text-white hover:bg-[#4bb193]' : 'bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600'}" do %>
          Year
        <% end %>
      </div>

      <!-- Date Navigation -->
      <div class="flex items-center space-x-3">
        <% if @view_type == "month" %>
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date - 1.month).strftime("%Y-%m")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          <% end %>
          
          <span class="text-sm font-medium text-slate-900 dark:text-slate-100 min-w-[8rem] text-center">
            <%= @date.strftime("%B %Y") %>
          </span>
          
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date + 1.month).strftime("%Y-%m")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          <% end %>
        <% else %>
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date - 1.year).strftime("%Y")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          <% end %>
          
          <span class="text-sm font-medium text-slate-900 dark:text-slate-100 min-w-[8rem] text-center">
            <%= @date.strftime("%Y") %>
          </span>
          
          <%= link_to admin_analytics_path(view_type: @view_type, date: (@date + 1.year).strftime("%Y")), 
              class: "p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" do %>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Top Posts Leaderboard -->
  <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4 md:p-6">
    <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">
      Top posts 
      <div class="text-sm font-normal text-slate-600 dark:text-slate-400">
        <%= @view_type == "month" ? @date.strftime("%B %Y") : @date.strftime("%Y") %>
      </div>
    </h3>
    
    <% if @top_posts.any? %>
      <div class="space-y-3">
        <% @top_posts.each_with_index do |post_data, index| %>
          <div class="flex items-start justify-between py-2 px-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700">
            <div class="flex items-start space-x-3 flex-1 min-w-0">
              <span class="text-sm font-mono text-slate-400 w-6 text-center flex-shrink-0 mt-0.5">
                <%= index + 1 %>
              </span>
              <div class="flex flex-col min-w-0 flex-1">
                <%= link_to post_data[:post].display_title, post_url(post_data[:post]), target: "_blank", class: "text-sm font-medium hover:underline truncate" %>
                <span class="text-xs text-slate-500 dark:text-slate-400">
                  <%= link_to blog_home_url(post_data[:post].blog), blog_home_url(post_data[:post].blog), target: "_blank", class: "hover:underline" %>
                </span>
              </div>
            </div>
            <div class="flex items-center space-x-2 flex-shrink-0 ml-3">
              <div class="hidden md:block bg-slate-200 dark:bg-slate-600 rounded-full h-2 w-20">
                <% max_views = @top_posts.first[:count] %>
                <% width = (post_data[:count].to_f / max_views * 100).round(1) %>
                <div class="rounded-full h-2 transition-all duration-300" style="width: <%= width %>%; background-color: #56cda9"></div>
              </div>
              <span class="text-sm font-semibold text-slate-900 dark:text-slate-100 min-w-[3rem] text-right">
                <%= number_with_delimiter(post_data[:count].to_i) %>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8 text-slate-500 dark:text-slate-400">
        No posts found
      </div>
    <% end %>
  </div>

  <!-- Top Blogs Leaderboard -->
  <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4 md:p-6">
    <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">
      Top blogs 
      <div class="text-sm font-normal text-slate-600 dark:text-slate-400">
        <%= @view_type == "month" ? @date.strftime("%B %Y") : @date.strftime("%Y") %>
      </div>
    </h3>
    
    <% if @top_blogs.any? %>
      <div class="space-y-3">
        <% @top_blogs.each_with_index do |blog_data, index| %>
          <div class="flex items-start justify-between py-2 px-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700">
            <div class="flex items-start space-x-3 flex-1 min-w-0">
              <span class="text-sm font-mono text-slate-400 w-6 text-center flex-shrink-0 mt-0.5">
                <%= index + 1 %>
              </span>
              <div class="flex flex-col min-w-0 flex-1">
                <%= link_to blog_data[:blog].display_name, blog_home_url(blog_data[:blog]), target: "_blank", class: "text-sm font-medium hover:underline truncate" %>
                <span class="text-xs text-slate-500 dark:text-slate-400">
                  <%= link_to blog_home_url(blog_data[:blog]), blog_home_url(blog_data[:blog]), target: "_blank", class: "hover:underline" %>
                </span>
              </div>
            </div>
            <div class="flex items-center space-x-2 flex-shrink-0 ml-3">
              <div class="hidden md:block bg-slate-200 dark:bg-slate-600 rounded-full h-2 w-20">
                <% max_views = @top_blogs.first[:count] %>
                <% width = (blog_data[:count].to_f / max_views * 100).round(1) %>
                <div class="rounded-full h-2 transition-all duration-300" style="width: <%= width %>%; background-color: #56cda9"></div>
              </div>
              <span class="text-sm font-semibold text-slate-900 dark:text-slate-100 min-w-[3rem] text-right">
                <%= number_with_delimiter(blog_data[:count].to_i) %>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8 text-slate-500 dark:text-slate-400">
        No blogs found
      </div>
    <% end %>
  </div>

  <!-- Top Blogs by Email Subscribers -->
  <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-4 md:p-6">
    <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-4">Most email subscribers</h3>
    
    <% if @top_blogs_by_subscribers.any? %>
      <div class="space-y-3">
        <% @top_blogs_by_subscribers.each_with_index do |blog_data, index| %>
          <div class="flex items-start justify-between py-2 px-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700">
            <div class="flex items-start space-x-3 flex-1 min-w-0">
              <span class="text-sm font-mono text-slate-400 w-6 text-center flex-shrink-0 mt-0.5">
                <%= index + 1 %>
              </span>
              <div class="flex flex-col min-w-0 flex-1">
                <%= link_to blog_data[:blog].display_name, blog_home_url(blog_data[:blog]), target: "_blank", class: "text-sm font-medium hover:underline truncate" %>
                <span class="text-xs text-slate-500 dark:text-slate-400">
                  <%= link_to blog_home_url(blog_data[:blog]), blog_home_url(blog_data[:blog]), target: "_blank", class: "hover:underline" %>
                </span>
              </div>
            </div>
            <div class="flex items-center space-x-2 flex-shrink-0 ml-3">
              <div class="hidden md:block bg-slate-200 dark:bg-slate-600 rounded-full h-2 w-20">
                <% max_subscribers = @top_blogs_by_subscribers.first[:count] %>
                <% width = (blog_data[:count].to_f / max_subscribers * 100).round(1) %>
                <div class="rounded-full h-2 transition-all duration-300" style="width: <%= width %>%; background-color: #56cda9"></div>
              </div>
              <span class="text-sm font-semibold text-slate-900 dark:text-slate-100 min-w-[3rem] text-right">
                <%= number_with_delimiter(blog_data[:count].to_i) %>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8 text-slate-500 dark:text-slate-400">
        No blogs with email subscribers found
      </div>
    <% end %>
  </div>
</div>
